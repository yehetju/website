<!DOCTYPE html>
<html>
  <head>
    <title>个人网站</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="./css/index.css">
    <link rel="stylesheet" href="./css/common.css">
    <script src="./js/jquery-2.1.1.min.js"></script>
    <script src="./js/http.js"></script>
  </head>
  <body style="font-size: 14rem;">
    <div class="region">
      <div class="region-head">汉语词典 &emsp;<span id="dictState"></span></div>
      <div class="region-content">
        <!-- <iframe id="dict" src="http://www.zdic.net" style="width: 100%;height: 300px;"></iframe> -->
        <iframe id="dict" style="display: none;"></iframe>
        <div class="search">
          <input id="kwd" placeholder="请输入汉字/词/成语" onkeydown="inputKwd(event)" class="form-control" style="width: 200px;display: inline-block;" />
          <button type="button" class="btn btn-default" onclick="search()">查找</button>
        </div>
        <div id="dictResult"></div>
        <script>
          var searching = null;
          function search(kwd){
            if(searching) searching.abort();
            if(kwd){
              $('#kwd').val(kwd);
              location.href = "#kwd";
            }else{
              kwd = $('#kwd').val();
            }
            $('#dictState').html('  正在查找"' + kwd + '"..')
            searching = http.jsonp({
              url: 'http://www.zdic.net/hans/' + kwd,
              success: function(res){
                var data = $(res).find('.dictionaries');
                data.find('.copyright, h3, .zdict:last-of-type, .adsbygoogle, .zib-title, .zyzx, .mpuslot_b-container').remove(); // 去掉评论区
                data.find('a').each(function(i,a){
                  if(a.href && a.href.indexOf('/hans/') > -1){
                    a.href = 'javascript: search("'+ a.innerText +'")';
                    $(a).css('margin-right', '10px');
                  }else{
                    a.href = '#';
                  }
                })
                
                data.find('h2').css('font-size','1.1em');
                $('#dictResult').html('');
                $('#dictResult').append(data);
                $('#dictState').html('')
              }
            })
          }
          function inputKwd(e){
            if(e.code == 'Enter'){
              search();
            }
          }
        </script>
      </div>
    </div>
    <div class="region episode">
      <div class="region-head">每日诗词</div>
      <div id="sentence">正在加载今日诗词....</div>
      <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
      <script type="text/javascript">
        var today = new Date().format('yyyy-MM-dd');
        
        var data = localStorage.getItem(today)
        
        if(!localStorage.getItem(today)){
          jinrishici.load(function(result) {
            // 自己的处理逻辑
            var art = result.data.origin;
            $('#sentence').html('')
            $('#sentence').append('<div class="title">'+art.title+'</div>');
            $('#sentence').append('<div class="author">'+art.dynasty + '·' + art.author+'</div>');
            $('#sentence').append('<div class="content"></div>');
            for(var i in art.content){
              $('#sentence .content').append(art.content[i]+'<br>');
            }
            localStorage.setItem(today, JSON.stringify(art));
          });
        }else{
          var art = JSON.parse(localStorage.getItem(today));
          $('#sentence').html('')
          $('#sentence').append('<div class="title">'+art.title+'</div>');
          $('#sentence').append('<div class="author">'+art.dynasty + '·' + art.author+'</div>');
          $('#sentence').append('<div class="content"></div>');
          for(var i in art.content){
            $('#sentence .content').append('<p>' + art.content[i]+'</p>');
          }
        }
        
      </script>
    </div>
    <div class="region">
      <div class="region-head">每日英语</div>
      <div id="english" class="region-content">正在加载....</div>
      <script>
        http.jsonp({
          url: 'https://apiv3.shanbay.com/weapps/dailyquote/quote/?date=' + today,
          success: function(res){
            let div = $('#english');
            div.html('')
            let img = res.origin_img_urls[0];
            div.append('<p class="english-img"><img src="' + img + '" /></p>');
            div.append('<p>' + res.content + '</p>');
            div.append('<p>' + res.translation + '</p>');
          }
        })
        
      </script>
    </div>
    
  </body>
</html>